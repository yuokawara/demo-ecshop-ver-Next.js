# rules.md

## 1. 基本的な振る舞い

- **日本語で書いてほしい**  
  開発チーム内の共通言語は日本語です。コードコメント以外の説明すべては日本語で記載してください。

- **ユーザーの指示に応じてモードを切り替える**
  1. 計画立案モード
     - 機能要件の整理やタスク分解など、設計・計画が必要なとき
     - → `about.md` のフォーマットに沿って、マークダウンで計画を出力する
  2. 実装モード
     - コードサンプルや実装手順を提示するとき
     - → 該当ファイル名を先頭に書き、具体的なコード例やコマンドを示す
  3. デバッグモード
     - エラーや不具合を確認し、原因調査・修正案を出すとき
     - → エラーメッセージを引用しつつ、原因推測と修正コードを示す

## 2. プロジェクト固有の技術スタック共有事項

- Next.js 15.x の App Router を使用
  - `params` や `generateStaticParams` の書き方は v14 以前と異なる
  - `<Image>` コンポーネントの `remotePatterns` 設定を忘れない
- MicroCMS クライアントは `createClient({ serviceDomain, apiKey })` を使用
  - 環境変数キー名は必ず `MICROCMS_SERVICE_DOMAIN`、`MICROCMS_API_KEY`
  - `fetchAllProducts()` では `get({ endpoint: "products" })` を利用
- Supabase の `auth-helpers-nextjs` は非推奨のため使わない
- API クライアントは `yarn codegen` で自動生成済み

## 3. Folder Structure や Naming Conventions

- `src/app/` 配下に各ページを置く（App Router）
- 共通コンポーネントは `src/app/components/`、ロジックは `src/app/utils/`
- タイプ定義は `src/app/types/` にまとめる
- 各フォルダ直下に必ず `README.md` を置き、目的やルールを短く記載
- ファイル・フォルダ名には番号や日付を入れて履歴がわかるようにする
  - 例: `20250604_initial-setup.md`、`001_task-getProducts.md`

## 4. 提示フォーマットのルール

- **マークダウン見出し**
  - 機能ごとに `##` レベルで階層化
  - コードブロックは必ず言語指定付きで囲う
    ```tsx
    <コードサンプル>
    ```
- **コードファイル名をコメントで明示**
  - 例:
    ```ts
    // src/app/products/page.tsx
    export default async function ProductsPage() { … }
    ```
- **改善タスクは GitHub Issue 化**
  - Issue 内に「000_about.md」「001_task.md」「DevLogs/」を作成し、進捗を都度書き込む

## 5. コードレビュールール

- プルリクエストタイトルには必ず番号と概要を入れる
  - 例: `[TASK#1250] 商品一覧取得 API 実装`
- レビュアーは下記をチェックリストとして確認
  1. Lint / 型エラーがないか
  2. パフォーマンスを阻害するループや重い処理がないか
  3. セキュリティ脆弱性（SQLインジェクション、XSS）がないか
  4. テスト（ユニットテスト／Integration テスト）が追加されているか
  5. README.md やコメントで仕様が説明されているか

## 6. 常時監視・デバッグの心得

- **エラー修正に固執しない**
  - 大枠の実装が完了するまで細かいバグは後回しにし、まずは動くプロトタイプを作る
- **GitHub Issue ごとに実装ログを残す**

issues/
├── #1250/
│ ├── 000_about.md # Issue 概要
│ ├── 001_task.md # 具体的なタスクリスト
│ └── DevLogs/
│ ├── 250601.md # 再現手順やデバッグログ
│ ├── 250602.md
│ └── 250603.md

- **大きな変更は分割して小さな単位で実装**
- 1 回のプルリクエストでできることはできるだけ少なく（Example: 1Issue＝1機能 or 1Refactor）

## 7. その他、開発を円滑にする Tips

- **コマンド自動実行は OFF にする**
- 自動整形やテスト実行を任意実行にして、大きなミスを防ぐ
- **音声入力を活用する**
- SuperWhisper や mac のショートカットキー（F5）を使って口述でコードを書けるようにする
- **深呼吸して休憩**
- AI とうまく噛み合わないときは一度脳をリフレッシュして別作業に移る

## MCPについて

project-root/
├── server/ ← MCP サーバー用ディレクトリ
│ ├── github-server/
│ ├── microcms-server/
│ └── package.json ← サーバー側の依存管理
├── client/ ← MCP クライアント用ライブラリ
│ └── index.ts
├── host/ ← 既存 Next.js アプリを host にリネーム
│ ├── src/
│ ├── package.json
│ └── ...
├── package.json ← ルートでワークスペース設定
└── tsconfig.json

将来的に「AI チャットでユーザーからの問い合わせに自動応答したい」

「社内の在庫管理システム／Google Sheets／社内DBをチャット経由でひとまとめに引き出したい」

「新しい外部 API を追加しても、既存のコードはほとんど変えずに拡張したい」

といった要件が出てくるのであれば、MCP をいまのうちに導入しておくと後々の拡張が非常にスムーズになります。

この記事を参考に、まずはローカル開発環境で「MCP サーバー＋クライアント＋ホスト（Next.js）」が連携する簡単なプロトタイプを作り、その動きを体感してみることをおすすめします。
